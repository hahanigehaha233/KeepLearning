## ALTER TABLE操作
在对表进行修改时，`ALTER TABLE`的方法是用新的结构创建一个空表，从旧表中查出所有数据插入新表，然后删除旧表，在内存不足、表很庞大和索引众多的情况下，会更加严重。

- 使用`ALTER COLUMN`比使用`ALTER TABLE`要快，不会重建表。
- 影子复制：通过重命名和删除表进行替换。


## 查询优化

#### 优化数据访问
查询性能低下最基本的原因是访问的数据太多，某些查询可能不可避免地需要筛选大量数据，大部分性能低下的查询都可以通过减少访问的数据量的方式进行优化：
- 确认应用程序是否在检索大量超过需要的数据。这意味着访问了太多的行，但是有时候也可能是访问了太多的列。
  - 不需要的记录：可以使用LIMIT限制
  - 多表返回全部列
  - 重复查询
- 确认MySQL服务器层是否在分析大量超过需要的数据行。

衡量查询开销的三个指标
- 相应时间
- 扫描的行数
- 返回的行数

其中，响应时间分为：服务时间和排队时间，排队常见的是I/O和锁等待。

MySQL中能够使用如下三种方式应用WHERE条件，从好到坏依次是：
- 在索引中使用WHERE来过滤不需要的信息。
- 所用索引覆盖来过滤不必要的信息。
- 从数据表中返回数据后，过滤不要的信息。

当出现扫描大量行但是只返回少数行的情况时，优化技巧：
- 使用索引覆盖
- 改变表结构，使用单独的汇总表等
- 重写查询

MySQL是属于半双工的通信协议，所以这意味着在任何一个时刻，要么由服务器向客户端发送数据，要么由客户端向服务器发送数据，在任何一方发送数据的阶段，另外一方就只能等待，所以数据的精炼是很重要的。

MySQL返回数据时，实际上是通过库函数的缓存获取数据，但是需要返回一个很大的结果集的时候，库函数会花很多时间去存储结果集，`mysql_unbuffered_query()`就只一种这样的函数。

## 查询状态
对于一个MySQL连接，或者说一个线程，任何时刻都有一个状态，该状态显示了MySQL目前在做什么。
- Sleep：线程正在等待客户端发送新的请求
- Query：线程正在执行查询或者正在将结果发送给客户端
- Locked：在MySQL服务器层，表示该线程正在等待锁。
- Analyzing and statistics:线程正在收集存储的统计信息，并生成查询的执行计划
- Copying to tmp table[on disk]:线程正在执行查询，并且将结果都复制到一个临时表中，这种状态要么是在做GROUP BY操作，要么是文件排序操作，或者是UNION操作。如果有on disk标记，则说明正在将临时表存到磁盘上。
- Sorting result：线程正在对结果集进行排序。
- Sending data：可能有多种情况，在多个状态之间传输，或者在生成结果集，或者在向客户到发送返回数据。
