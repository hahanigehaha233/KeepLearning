## 空间配置器
一般说的就是`std::alloc`，在`<memory>`中实现，包含三个文件
- `<stl_construct.h>`:定义了全局函数`construct()`和`destroy()`，这两个方法会调用对象的构造和析构函数。
- `<stl_alloc.h>`:内存的配置和释放在这里面实现，内部有两级配置器，第一级结构简单，封装了`malloc`和`free`，主要针对的是大内存分配，而第二级实现了自由链表和内存池，用于提升大量小额内存分配时的性能。
- `<stl_uninitialiezed.h>`：大块内存的操作。

其中，一级配置器有函数
- `allocate()`:调用malloc进行分配
- `deallocate()`:调用free进行回收
- `oom_malloc()和oom_realloc()`:在空间不足的时候进行分配

二级配置器中会对小于128bytes的内存分配使用free-list进行管理，这样会造成一定的资源浪费（指针占用），使用Union实现减少浪费。

一般的内存分配顺序是：
1. 调用空间配置函数allocate()，如果申请的区块大于128bytes则调用第一级配置器，如果小于则检查对应的free-list查看是否有可用的区块。
2. 如果没有可用的区块，将申请大小上调到8的倍数，然后调用refill()，该函数会从内存池中获取20个新的节点，并加入到free-list中。从内存池中寻找是chunk_alloc()的工作。
3. chunk_alloc()首先会检测内存剩余空间，如果满足的话直接返回，如果不满足全部但是满足供应一个或以上的区块，也返回；如果连一个区块都满足不了的时候，只有一些零头，会将其加入适当地free-list中，让后在system_heap中进行配置，如果系统都没有的话会发出bad_alloc异常。

**注意**
- free-list是按照区块大小进行划分的。
- 每次chunk_alloc会申请多一点的空间，多余空间会放入free_list中。
- 参考《STL源码剖析》P68
