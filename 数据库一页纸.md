## 面试终极一页纸

#### Redis
- String：一个Key对应一个Value，可以是字符或者数字，二进制安全，512M
- Hash：键值对，使用hashtable实现，链地址法
- List：字符串列表，可以前后插入，双向链表实现
- Set：也是Hashtable实现，不过KV值相同
- Order Set：实现方式：Redis Sorted Set 的内部使用 HashMap 和跳跃表（skipList）来保证数据的存储和有序，HashMap 里放的是成员到 Score 的映射。而跳跃表里存放的是所有的成员，排序依据是 HashMap 里存的 Score，使用跳跃表的结构可以获得比较高的查找效率，并且在实现上比较简单。


**为什么快**：1. 纯内存操作。2.单线程操作，避免了上下文切换。3.采用了非阻塞式的IO复用。因为 Redis 完全是基于内存的操作，CPU 不是 Redis 的瓶颈，Redis 的瓶颈最有可能是机器内存的大小或者网络带宽。

**雪崩**：缓存中所有的key在同一时间失效，请求全部落在了数据库上。
解决办法：设置随机值；永不过期，更新缓存。

**穿透**：没有的数据一直发送请求落在数据库上
办法：设置没有就返回，布隆过滤器利用高效的数据结构和算法快速判断出你这个 Key 是否在数据库中存在，不存在你 return 就好了，存在你就去查 DB 刷新 KV 再 return。

**击穿**：一个KV非常热，突然失效，大量请求落在数据库上。
解决：永不过期。


**淘汰策略**：分为过期时间和全部的，最近未使用，剩余时间短，随机

**RDB**：RDB是一个时间点的全部的数据快照，是一个二进制的文件。复制时主进程有更新放入临时内存区域，完成后同步到主内存，可以自动启动或者按时启动。写时复制（缺点：缺页中断可能很多）。
缺点：丢失数据会很多，增量数据。会阻塞进程。不兼容

**AOF**：基于写操作存储，文本文件，会持续增大，瘦身，文件操作，延迟写入。
优点：比RDB快，文件较大。
对大粒度的数据使用RDB进行存储，而在RDB途中的数据可以使用AOF存储，这样在重启效率上就会很高

**主从复制**：可以进行全量复制和部分复制，在进行复制的时候的增量会放入缓冲区，并在后续以增量复制的形式发送。有uuid和offset字段
- 从节点执行 slaveof[masterIP][masterPort]，保存主节点信息。
- 从节点中的定时任务发现主节点信息，建立和主节点的 Socket 连接。
- 从节点发送 Ping 信号，主节点返回 Pong，两边能互相通信。
- 连接建立后，主节点将所有数据发送给从节点（数据同步）。
- 主节点把当前的数据同步给从节点后，便完成了复制的建立过程。接下来，主节点就会持续的把写命令发送给从节点，保证主从数据一致性。

**哨兵**：使用集群的方式提升单机的限制，主从切换，主活节点检测，故障转移。
1. Sentinel 以每秒一次的频率，向它所知的主服务器、从服务器以及其他的 Sentinel 实例发送一个 PING 命令
2. 有效回复 PING 命令的时间超过所指定的值， 标记为主观下线
3. 所有 Sentinel 节点，要以每秒一次的频率确认主服务器的确进入了主观下线状态
4. 足够数量的 Sentinel 标记客观下线。
5.投票自动选出新的主节点，将剩余从节点指向新的主节点进行数据复制


**一致性哈希**：集群模式下，对键值对所在的节点进行hash计算，得到节点信息，并且一致性hash针对节点插入和删除之后不会需要全部进行更改。只会影响一部分的。


---


#### MySQL
范式：1.每一列属性都不可再分。2.实体完全依赖主键。3.非主键部分不依赖其他非主键部分
优点：当数据数据范式化时，只会有很少的重复数据；通常更小。缺点：复杂的查询需要关联多个表

##### 索引
索引是为了加速数据库的查找，其本身也是一张表，所以在进行更新操作的时候，拥有索引的表更新速度会变慢。分为B+和哈希索引。

B+索引分为Innodb聚集索引，B+树索引在遇到=,>,>=,<,<=等操作时是可以使用索引搜索的。
like也可以使用，只要最开始不是以通配符开始的。**模糊查询的速度快**

**最左匹配**：联合索引的概念，数据库会按照联合索引的顺序建立搜索表，在查找数据时数据库会按照联合索引中的顺序从左到右进行匹配，当中间有条件缺失或者不确定时（大于符号等）会停止匹配。

**哈希索引**：不支持索引排序，最左匹配，线性查找，模糊查找

---

**事务**：
- 原子性(A)：事务时最小单位，不可再分的。
- 一致性( C): 事务要求所有的DML语句在操作的时候，要么同时成功，要么同时失败。
- 隔离性(I): 事务A和事务B直接具有隔离性。
- 持久性(D): 是事务的保证，事务终结的保证（内存的数据持久到硬盘文件中）。

幻读是MVCC产生的（快照读），加入间隙锁去修正，for update。

---

#### 锁
- 悲观锁：每次进行操作的时候都会先加锁锁定，悲观地认为每个数据都是易变地。
- 乐观锁：不认为数据易变，所以插入时不会加锁，使用增加version和timestamp字段实现。CAS和版本控制



